#include <ctime>
#include <iostream>
#include <fstream>
#include <sstream>
#include <iomanip>
#include <algorithm>
#include <string>
#include <cmath>
#include <cassert>
#include <gsl/gsl_rng.h>
#include <gsl/gsl_randist.h>
#include "bramauxiliary.h"


//#define NDEBUG


using namespace std;


// give the outputfile a unique name
// by using the create_filename function (see 
// "bramauxiliary.h")
string filename("iter_conflict");
string filename_new(create_filename(filename));
ofstream DataFile(filename_new.c_str());  // output file 

int main(int argc, char **argv)
{
    double s1, s1tplus1;
    double s2, s2tplus1;

    double p1 = atof(argv[1]);
    double n = atof(argv[2]);
    double d = atof(argv[3]);
    double sigma12 = atof(argv[4]);
    double sigma21 = atof(argv[5]);

    // eigenvector related thiings
    double ev, v1, v2, u1;
    double dWds1mother, dWds2mother, dWds1offspring, dWds2offspring;

    DataFile << "type;s1;s2;p1;d;n;c1;c2;sigma12;sigma21;ev;u1;v1;v2;" << endl;

    // first offspring strategies
    for (double c2 = 0; c2 <= 1.0; c2+=0.02)
    {
        for (double c1 = 0; c1 <= 1.0; c1+=0.02)
        {
            s1 = 0.5;
            s2 = 0.5;

            for (size_t iter = 0; iter < 10000000; ++iter)
            {
                // first calculate eigenvectors et al 
                ev = (((-1 + c2*s2)*((d*p1*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + ((1 - d*p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. + ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2. + sqrt(-4*(-(d*c1*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*pow(p1,2)*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*pow(p1,2)*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*pow(p1,2)*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*pow(p1,2)*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*pow(p1,2)*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*pow(p1,2)*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - ((1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (c1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (c1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*s1*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*(1 - p1)*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c2*s2*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (c1*c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*s2*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (c1*c2*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*s1*s2*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*(1 - p1)*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*p1*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*p1*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (c1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c2*s1*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (c1*c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*s1*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (c1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*s2*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*(1 - p1)*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (c1*c2*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*s1*s2*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*(1 - p1)*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*p1*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*p1*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*pow(1 - p1,2)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*pow(1 - p1,2)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*pow(1 - p1,2)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*pow(1 - p1,2)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*pow(1 - p1,2)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*pow(1 - p1,2)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2))))) + pow(((-1 + c2*s2)*((d*p1*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + ((1 - d*p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. + ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.,2)))/2.;

u1 = (((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/(2.*(ev + ((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.)));

v1 = (((1 + c1*(-1 + s2))*(ev + ((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.)*(sigma21/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)) + d*((p1*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) - (p1*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)))))/(2.*(pow(ev,2) - ev*(1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))) + (pow(1 + c1*(-1 + s1),2)*pow(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)),2))/4. + ((-1 + c2*s1)*(1 + c1*(-1 + s2))*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2))))*(sigma21/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)) + d*((p1*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) - (p1*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)))))/4.)));

v2 = (((ev - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.)*(ev + ((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.))/(pow(ev,2) - ev*(1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))) + (pow(1 + c1*(-1 + s1),2)*pow(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)),2))/4. + ((-1 + c2*s1)*(1 + c1*(-1 + s2))*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2))))*(sigma21/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)) + d*((p1*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) - (p1*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)))))/4.));



                // then evaluate selection gradients mother
                dWds1mother = (1 - u1)*v1*((pow(1 - d,2)*c2*(1 - s1 + (1 - c2)*s1)*sigma12*((pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - n*(1 + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))))/(2.*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(-pow(n,2) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,2)*pow(n,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (2*pow(1 - d,4)*n*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*pow(n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21)*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))) + ((-((1 - d)*c2*sigma12)/(2.*((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) + (d*(-((c2*p1*sigma12)/((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) - (c2*(1 - p1)*(1 - sigma21))/(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))))/2.)*(1 + ((pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - n*(1 + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(-pow(n,2) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,2)*pow(n,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (2*pow(1 - d,4)*n*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*pow(n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21)*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))))/2.) + u1*v1*(-(pow(1 - d,2)*c1*((1 - c1)*(1 - s1) + s1)*(1 - sigma12)*((pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - n*(1 + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))))/(2.*pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(-pow(n,2) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,2)*pow(n,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (2*pow(1 - d,4)*n*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*pow(n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21)*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))) + ((((1 - d)*c1*(1 - sigma12))/(2.*((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))) + (d*((c1*p1*(1 - sigma12))/((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2)) + (c1*(1 - p1)*sigma21)/(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))))/2.)*(1 + ((pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - n*(1 + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(-pow(n,2) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,2)*pow(n,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (2*pow(1 - d,4)*n*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*pow(n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21)*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))))/2.);

dWds2mother = (1 - u1)*v2*(-(pow(1 - d,2)*c2*(1 - s2 + (1 - c2)*s2)*(1 - sigma21)*(n + (pow(1 - d,2)*(-1 + n)*p1*pow(1 - s1 + (1 - c2)*s1,2)*sigma12)/(pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(2.*pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*((pow(1 - d,4)*pow(-1 + n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (-n + (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))) + (((d*(-((c2*p1*sigma12)/((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) - (c2*(1 - p1)*(1 - sigma21))/(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))))/2. - ((1 - d)*c2*(1 - sigma21))/(2.*(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))))*(1 - (n + (pow(1 - d,2)*(-1 + n)*p1*pow(1 - s1 + (1 - c2)*s1,2)*sigma12)/(pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))/((pow(1 - d,4)*pow(-1 + n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (-n + (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))))/2.) + u1*v2*((pow(1 - d,2)*c1*((1 - c1)*(1 - s2) + s2)*sigma21*(n + (pow(1 - d,2)*(-1 + n)*p1*pow(1 - s1 + (1 - c2)*s1,2)*sigma12)/(pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(2.*pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*((pow(1 - d,4)*pow(-1 + n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (-n + (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))) + ((((1 - d)*c1*sigma21)/(2.*(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))) + (d*((c1*p1*(1 - sigma12))/((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2)) + (c1*(1 - p1)*sigma21)/(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))))/2.)*(1 - (n + (pow(1 - d,2)*(-1 + n)*p1*pow(1 - s1 + (1 - c2)*s1,2)*sigma12)/(pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))/((pow(1 - d,4)*pow(-1 + n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (-n + (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))))/2.);



                // update values
                s1tplus1 = s1 + 0.01 * dWds1mother;
                s2tplus1 = s2 + 0.01 * dWds2mother;

                if (s1tplus1 < 0)
                {
                    s1tplus1 = 0;
                } else if (s1tplus1 > 1.0)
                {
                    s1tplus1 = 1.0;
                }
                
                if (s2tplus1 < 0)
                {
                    s2tplus1 = 0;
                } else if (s2tplus1 > 1.0)
                {
                    s2tplus1 = 1.0;
                }

                if (
                        (fabs(s2tplus1 - s2) < 1e-08 &&
                        fabs(s1tplus1 - s1) < 1e-08)
                        ||
                        iter == 10000000 - 1
                )
                {
                    s2 = s2tplus1;
                    s1 = s1tplus1;
                    DataFile << "mother;" << s1 << ";" << s2 << ";" << p1 << ";" << d << ";" << n << ";" << c1 << ";" << c2 << ";" << sigma12 << ";" << sigma21 << ";" << ev << ";" << u1 << ";" << v1 << ";" << v2 << ";" << endl;
                    break;
                }
                
                s1 = s1tplus1;
                s2 = s2tplus1;
            }

            s1 = 0.5;
            s2 = 0.5;

            
            for (size_t iter = 0; iter < 10000000; ++iter)
            {
                // first calculate eigenvectors et al 
                ev = (((-1 + c2*s2)*((d*p1*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + ((1 - d*p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. + ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2. + sqrt(-4*(-(d*c1*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*p1*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*pow(p1,2)*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*pow(p1,2)*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*pow(p1,2)*s1*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*p1*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*pow(p1,2)*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*pow(p1,2)*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*pow(p1,2)*s2*(1 - sigma12)*sigma12)/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - ((1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (c1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*p1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (c1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*s1*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*(1 - p1)*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*p1*s1*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c2*s2*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (c1*c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*s2*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*p1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (c1*c2*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*s1*s2*(1 - sigma12)*(1 - sigma21))/(2.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*(1 - p1)*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*p1*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*p1*s1*s2*(1 - sigma12)*(1 - sigma21))/(4.*(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2)))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (c1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*p1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c2*s1*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (c1*c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*s1*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*p1*s1*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (c1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*s2*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*(1 - p1)*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*p1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (c1*c2*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (d*c1*c2*s1*s2*sigma12*sigma21)/(2.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*(1 - p1)*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*c2*p1*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*p1*s1*s2*sigma12*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2)))) - (d*c1*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*(1 - p1)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*pow(1 - p1,2)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*pow(1 - p1,2)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*pow(1 - p1,2)*s1*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c1*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (d*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (d*c1*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*c2*(1 - p1)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c1*pow(1 - p1,2)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) + (pow(d,2)*c2*pow(1 - p1,2)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))) - (pow(d,2)*c1*c2*pow(1 - p1,2)*s2*(1 - sigma21)*sigma21)/(4.*(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))*(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2))))) + pow(((-1 + c2*s2)*((d*p1*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + ((1 - d*p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. + ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.,2)))/2.;

u1 = (((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/(2.*(ev + ((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.)));

v1 = (((1 + c1*(-1 + s2))*(ev + ((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.)*(sigma21/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)) + d*((p1*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) - (p1*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)))))/(2.*(pow(ev,2) - ev*(1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))) + (pow(1 + c1*(-1 + s1),2)*pow(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)),2))/4. + ((-1 + c2*s1)*(1 + c1*(-1 + s2))*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2))))*(sigma21/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)) + d*((p1*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) - (p1*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)))))/4.)));

v2 = (((ev - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.)*(ev + ((-1 + c2*s1)*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2)))))/2. - ((1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))))/2.))/(pow(ev,2) - ev*(1 + c1*(-1 + s1))*(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2))) + (pow(1 + c1*(-1 + s1),2)*pow(((1 + d*(-1 + p1))*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) + (d*(1 - p1)*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)),2))/4. + ((-1 + c2*s1)*(1 + c1*(-1 + s2))*(((1 + d*(-1 + p1))*sigma12)/(-1 + c2*s1 + d*(1 - c2*s1 + p1*(-1 + c2*s1) + (1 - p1)*(-1 + c2*s2))) + (d*(1 - p1)*(1 - sigma21))/(-1 + c2*s2 + d*(p1*(-1 + c2*s1) - p1*(-1 + c2*s2))))*(sigma21/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)) + d*((p1*(1 - sigma12))/(1 + c1*(-1 + s1) + d*c1*(1 + p1*(-1 + s1) - s1 + (1 - p1)*(-1 + s2))) - (p1*sigma21)/(1 + d*c1*(p1*(-1 + s1) - p1*(-1 + s2)) + c1*(-1 + s2)))))/4.));



                // then evaluate selection gradients offspring
                dWds1offspring = u1*v1*(((1 - d)*c1*(1 - sigma12))/(2.*((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))) + (d*((c1*p1*(1 - sigma12))/((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2)) + (c1*(1 - p1)*sigma21)/(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))))/2. - (pow(1 - d,2)*c1*((1 - c1)*(1 - s1) + s1)*(1 - sigma12)*((pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - n*(1 + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))))/(2.*pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(-pow(n,2) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,2)*pow(n,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (2*pow(1 - d,4)*n*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*pow(n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21)*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21)))))) + (1 - u1)*v1*(-((1 - d)*c2*sigma12)/(2.*((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) + (d*(-((c2*p1*sigma12)/((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) - (c2*(1 - p1)*(1 - sigma21))/(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))))/2. + (pow(1 - d,2)*c2*(1 - s1 + (1 - c2)*s1)*sigma12*((pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - n*(1 + (pow(1 - d,2)*(1 - p1)*pow((1 - c1)*(1 - s2) + s2,2)*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))))/(2.*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(-pow(n,2) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,2)*pow(n,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (2*pow(1 - d,4)*n*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) + (pow(1 - d,4)*pow(n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21)*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))));

dWds2offspring = (1 - u1)*v2*((d*(-((c2*p1*sigma12)/((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) - (c2*(1 - p1)*(1 - sigma21))/(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))))/2. - ((1 - d)*c2*(1 - sigma21))/(2.*(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2))) - (pow(1 - d,2)*c2*(1 - s2 + (1 - c2)*s2)*(1 - sigma21)*(n + (pow(1 - d,2)*(-1 + n)*p1*pow(1 - s1 + (1 - c2)*s1,2)*sigma12)/(pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(2.*pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*((pow(1 - d,4)*pow(-1 + n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (-n + (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)))))) + u1*v2*(((1 - d)*c1*sigma21)/(2.*(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))) + (d*((c1*p1*(1 - sigma12))/((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2)) + (c1*(1 - p1)*sigma21)/(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2))))/2. + (pow(1 - d,2)*c1*((1 - c1)*(1 - s2) + s2)*sigma21*(n + (pow(1 - d,2)*(-1 + n)*p1*pow(1 - s1 + (1 - c2)*s1,2)*sigma12)/(pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))) + (pow(1 - d,2)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (pow(1 - d,2)*n*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))/(2.*pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*((pow(1 - d,4)*pow(-1 + n,2)*(1 - p1)*p1*pow(1 - s1 + (1 - c2)*s1,2)*pow((1 - c1)*(1 - s2) + s2,2)*sigma12*sigma21)/(pow(d*p1*((1 - c1)*(1 - s1) + s1) + (1 - d)*((1 - c1)*(1 - s2) + s2) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*pow((1 - d)*(1 - s1 + (1 - c2)*s1) + d*p1*(1 - s1 + (1 - c2)*s1) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))*(p1*(1 - sigma12) + (1 - p1)*sigma21)) - (-n + (pow(1 - d,2)*(-1 + n)*(1 - p1)*pow(1 - s2 + (1 - c2)*s2,2)*(1 - sigma21))/(pow(d*p1*(1 - s1 + (1 - c2)*s1) + (1 - d)*(1 - s2 + (1 - c2)*s2) + d*(1 - p1)*(1 - s2 + (1 - c2)*s2),2)*(p1*sigma12 + (1 - p1)*(1 - sigma21))))*(-n + (pow(1 - d,2)*(-1 + n)*p1*pow((1 - c1)*(1 - s1) + s1,2)*(1 - sigma12))/(pow((1 - d)*((1 - c1)*(1 - s1) + s1) + d*p1*((1 - c1)*(1 - s1) + s1) + d*(1 - p1)*((1 - c1)*(1 - s2) + s2),2)*(p1*(1 - sigma12) + (1 - p1)*sigma21))))));



                // update values
                s1tplus1 = s1 + 0.01 * dWds1offspring;
                s2tplus1 = s2 + 0.01 * dWds2offspring;

                if (s1tplus1 < 0)
                {
                    s1tplus1 = 0;
                } else if (s1tplus1 > 1.0)
                {
                    s1tplus1 = 1.0;
                }
                
                if (s2tplus1 < 0)
                {
                    s2tplus1 = 0;
                } else if (s2tplus1 > 1.0)
                {
                    s2tplus1 = 1.0;
                }

                if (
                        (fabs(s2tplus1 - s2) < 1e-08 &&
                        fabs(s1tplus1 - s1) < 1e-08)
                        ||
                        iter == 10000000 - 1
                )
                {
                    s2 = s2tplus1;
                    s1 = s1tplus1;
                    DataFile << "offspring;" << s1 << ";" << s2 << ";" << p1 << ";" << d << ";" << n << ";" << c1 << ";" << c2 << ";" << sigma12 << ";" << sigma21 << ";" << ev << ";" << u1 << ";" << v1 << ";" << v2 << ";" << endl;
                    break;
                }
                
                s2 = s2tplus1;
                s1 = s1tplus1;
            }

        }
    }
}
